<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Gradient Identique pour tous les triangles</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
      #controls {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <canvas id="webglCanvas"></canvas>
    <div id="controls">
      <label
        >Couleur:
        <select id="colorSelect">
          <option value="blue">Bleu</option>
          <option value="rose">Rose</option>
          <option value="paradise">Oiseau de paradis</option>
        </select>
      </label>
    </div>

    <script type="text/javascript">
      const canvas = document.getElementById("webglCanvas");
      const gl = canvas.getContext("webgl");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      // --- Shaders ---
      const vertexShaderSource = `
attribute vec2 aPosition;
void main() {
  gl_Position = vec4(aPosition, 0.0, 1.0);
}
`;

      const fragmentShaderSource = `
precision mediump float;
uniform vec4 uColor1;
uniform vec4 uColor2;
void main() {
  float t = gl_FragCoord.y / float(${canvas.height});
  vec4 color = mix(uColor1, uColor2, t);
  gl_FragColor = color;
}
`;

      // --- Compile Shaders ---
      function createShader(type, source) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          console.error(gl.getShaderInfoLog(shader));
          gl.deleteShader(shader);
          return null;
        }
        return shader;
      }
      const vertexShader = createShader(gl.VERTEX_SHADER, vertexShaderSource);
      const fragmentShader = createShader(
        gl.FRAGMENT_SHADER,
        fragmentShaderSource
      );

      // --- Link Program ---
      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
        console.error(gl.getProgramInfoLog(program));
      }
      gl.useProgram(program);

      // --- Buffers pour triangles ---
      const vertices = new Float32Array([
        // Triangle 1
        -0.5, -0.5, 0.5, -0.5, 0.0, 0.5,

        // Triangle 2
        0.5, -0.5, 1.0, 0.0, 0.0, 0.5,

        // Ajoute d'autres triangles ici si besoin
      ]);

      const vbo = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

      const aPosition = gl.getAttribLocation(program, "aPosition");
      gl.vertexAttribPointer(aPosition, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(aPosition);

      // --- Uniformes pour le gradient ---
      const uColor1 = gl.getUniformLocation(program, "uColor1");
      const uColor2 = gl.getUniformLocation(program, "uColor2");

      function setGradient(colorName) {
        let color1, color2;
        switch (colorName) {
          case "blue":
            color1 = [0.0, 0.3, 1.0, 1.0];
            color2 = [0.0, 0.6, 1.0, 1.0];
            break;
          case "rose":
            color1 = [1.0, 0.3, 0.6, 1.0];
            color2 = [1.0, 0.6, 0.8, 1.0];
            break;
          case "paradise":
            color1 = [0.6, 0.0, 1.0, 1.0];
            color2 = [1.0, 0.5, 0.0, 1.0];
            break;
          default:
            color1 = [1.0, 1.0, 1.0, 1.0];
            color2 = [0.0, 0.0, 0.0, 1.0];
        }
        gl.uniform4fv(uColor1, color1);
        gl.uniform4fv(uColor2, color2);
      }

      // --- Initialisation du gradient ---
      setGradient(document.getElementById("colorSelect").value);

      // --- Listener pour changer le gradient ---
      document.getElementById("colorSelect").addEventListener("change", (e) => {
        setGradient(e.target.value);
        drawScene();
      });

      // --- Dessin de la scÃ¨ne ---
      function drawScene() {
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.clear(gl.COLOR_BUFFER_BIT);
        gl.drawArrays(gl.TRIANGLES, 0, vertices.length / 2);
      }
      drawScene();

      // --- Resize dynamique ---
      window.addEventListener("resize", () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawScene();
      });
    </script>
  </body>
</html>
